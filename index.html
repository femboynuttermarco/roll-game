<script>
  const items = [
    {
      name: "1oneam",
      image: "https://tse3.mm.bing.net/th/id/OIP.A8khKcsvIOv8CEdGb8MzhwHaHa?rs=1&pid=ImgDetMain&o=7&rm=3",
      rarity: "1 in 25",
      chance: 4
    },
    {
      name: "summrs",
      image: "https://th.bing.com/th/id/OIP.4dYbI1Gg7ggfOXOBUC76BwAAAA?w=131&h=180&c=7&r=0&o=5&dpr=1.3&pid=1.7",
      rarity: "1 in 10",
      chance: 10
    },
    {
      name: "nettspend",
      image: "https://th.bing.com/th/id/OIP.R6d7AGZ6x7bUeT7fZ0eg9gHaHa?w=170&h=180&c=7&r=0&o=7&dpr=1.3&pid=1.7&rm=3",
      rarity: "1 in 50",
      chance: 2
    },
    {
      name: "osamason",
      image: "https://th.bing.com/th/id/OIP.oaz6mkuhrcsEDwAVAVjNQQHaEK?w=322&h=181&c=7&r=0&o=7&dpr=1.3&pid=1.7&rm=3",
      rarity: "1 in 75",
      chance: 1.33
    }
  ];

  let pulledSet = new Set();
  let coins = 0;
  let pullCounts = {}; // Track how many times each item has been pulled

  // Load saved data from localStorage
  function loadGame() {
    const savedCoins = localStorage.getItem('coins');
    const savedPulled = localStorage.getItem('pulled');
    const savedCounts = localStorage.getItem('pullCounts');

    if (savedCoins !== null) coins = parseInt(savedCoins);
    if (savedPulled !== null) pulledSet = new Set(JSON.parse(savedPulled));
    if (savedCounts !== null) pullCounts = JSON.parse(savedCounts);

    updateCoinDisplay();
    updateIndexList();
  }

  // Save to localStorage
  function saveGame() {
    localStorage.setItem('coins', coins);
    localStorage.setItem('pulled', JSON.stringify(Array.from(pulledSet)));
    localStorage.setItem('pullCounts', JSON.stringify(pullCounts));
  }

  function updateIndexList() {
    const index = document.getElementById('artistIndex');
    index.innerHTML = '';

    for (let item of items) {
      const div = document.createElement('div');
      div.className = 'artist-card';

      const img = document.createElement('img');
      img.src = item.image;
      if (!pulledSet.has(item.name)) img.classList.add('blurred');

      const name = document.createElement('div');
      name.className = 'artist-name';
      name.textContent = pulledSet.has(item.name) ? item.name : "???";

      div.appendChild(img);
      div.appendChild(name);
      index.appendChild(div);
    }
  }

  function updateCoinDisplay() {
    document.getElementById('coinCount').textContent = `Coins: ${coins}`;
    saveGame();
  }

  function showSection(id) {
    document.querySelectorAll('.section').forEach(section => {
      section.classList.remove('active');
    });
    document.getElementById('message').textContent = '';
    document.getElementById(id).classList.add('active');
  }

  function earnCoin() {
    coins += 1;
    updateCoinDisplay();
  }

  function pull() {
    if (coins < 50) {
      document.getElementById('message').textContent = "Not enough coins! Earn more in the Coins section.";
      return;
    }

    coins -= 50;
    updateCoinDisplay();
    document.getElementById('message').textContent = "";

    const totalWeight = items.reduce((sum, item) => sum + item.chance, 0);
    let random = Math.random() * totalWeight;

    for (let item of items) {
      if (random < item.chance) {
        document.getElementById('itemImage').src = item.image;
        document.getElementById('itemText').textContent = `You have pulled ${item.name}!`;
        document.getElementById('itemRarity').textContent = `Rarity: ${item.rarity}`;
        document.getElementById('result').style.display = 'block';

        pulledSet.add(item.name);

        // Update pull count
        if (!pullCounts[item.name]) {
          pullCounts[item.name] = 1;
        } else {
          pullCounts[item.name]++;
        }

        // Refund 25 coins every 7 pulls of the same artist
        if (pullCounts[item.name] % 7 === 0) {
          coins += 25;
          document.getElementById('message').textContent = `Bonus! You've pulled ${item.name} ${pullCounts[item.name]} times and got a 25 coin refund!`;
        }

        updateCoinDisplay();
        updateIndexList();
        saveGame();
        return;
      }
      random -= item.chance;
    }
  }

  // Initialize on page load
  window.onload = loadGame;
</script>
